<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸš€ Mundo MatemÃ¡tico de AndrÃ©s</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --y:#FFD93D;--o:#FF6B35;--b:#4ECDC4;--p:#A855F7;
  --pk:#FF6B9D;--g:#06D6A0;--bg:#0d0720;
  --card:rgba(255,255,255,.08);--border:rgba(255,255,255,.14);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{
  width:100%;height:100%;
  font-family:'Nunito',sans-serif;
  background:var(--bg);
  overflow:hidden; /* each screen scrolls internally */
}

/* â”€â”€ ORBS â”€â”€ */
.orbs{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.18;animation:obf 9s ease-in-out infinite alternate;}
.o1{width:60vw;height:60vw;background:#7C3AED;top:-15vw;left:-15vw;}
.o2{width:50vw;height:50vw;background:#FF6B35;bottom:-10vw;right:-10vw;animation-delay:4s;}
.o3{width:40vw;height:40vw;background:#4ECDC4;top:40%;left:50%;animation-delay:2s;}
@keyframes obf{from{transform:translate(0,0)}to{transform:translate(30px,40px)}}
.star-bg{position:fixed;inset:0;pointer-events:none;z-index:0;}
.sd{position:absolute;border-radius:50%;background:#fff;animation:tw 2s infinite alternate;}
@keyframes tw{from{opacity:.1}to{opacity:.7}}

/* â”€â”€ SCREEN SYSTEM â”€â”€ */
/* Every screen fills the full viewport and scrolls internally */
.screen{
  position:fixed;inset:0;z-index:10;
  display:none;flex-direction:column;
  align-items:center;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  padding:env(safe-area-inset-top,14px) 14px env(safe-area-inset-bottom,14px);
}
.screen.on{display:flex;}

/* â”€â”€ GLOBAL TOP-BAR (home + coins) â”€â”€ */
.top-nav{
  width:100%;max-width:500px;
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 0 10px;
  flex-shrink:0;
}
.home-btn{
  background:rgba(255,255,255,.12);border:2px solid rgba(255,255,255,.2);
  border-radius:14px;padding:7px 14px;
  color:#fff;font-family:'Fredoka One',cursive;font-size:.9rem;
  cursor:pointer;display:flex;align-items:center;gap:5px;
  transition:background .2s;
}
.home-btn:hover{background:rgba(255,255,255,.22);}
.coins-pill{
  display:flex;align-items:center;gap:5px;
  background:rgba(255,215,0,.14);border:2px solid rgba(255,215,0,.32);
  border-radius:20px;padding:5px 12px;cursor:pointer;
}
.coins-pill span.val{font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--y);}
.coin-spin{font-size:1.2rem;animation:cspin 4s linear infinite;}
@keyframes cspin{0%,100%{transform:rotateY(0)}50%{transform:rotateY(180deg)}}

/* â”€â”€ CONTENT WRAPPER (centers and limits width) â”€â”€ */
.cw{width:100%;max-width:500px;display:flex;flex-direction:column;align-items:center;flex:1;}

/* â•â• COVER SCREEN â•â• */
#s-cover{justify-content:center;}
.cover-rocket{font-size:min(18vw,80px);animation:rocketBob 2s ease-in-out infinite;filter:drop-shadow(0 0 20px rgba(78,205,196,.6));}
@keyframes rocketBob{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-12px) rotate(5deg)}}
.cover-title{
  font-family:'Fredoka One',cursive;
  font-size:min(12vw,52px);
  background:linear-gradient(135deg,#FFD93D,#FF6B35,#4ECDC4,#A855F7);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  line-height:1.15;text-align:center;margin:10px 0 4px;
  animation:titleIn .7s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes titleIn{from{transform:scale(.4);opacity:0}to{transform:scale(1);opacity:1}}
.cover-sub{color:var(--b);font-size:min(4vw,16px);font-weight:700;letter-spacing:1px;margin-bottom:24px;}
.big-btn{
  font-family:'Fredoka One',cursive;font-size:min(5vw,22px);
  background:linear-gradient(135deg,#4ECDC4,#A855F7);color:#fff;
  border:none;border-radius:36px;padding:14px 44px;
  cursor:pointer;box-shadow:0 8px 28px rgba(78,205,196,.45);
  transition:transform .2s;
}
.big-btn:active{transform:scale(.96);}

/* â•â• LEVEL SELECT â•â• */
#s-levels{padding-top:0;}
.ls-title{font-family:'Fredoka One',cursive;font-size:min(7vw,28px);color:var(--y);margin-bottom:10px;text-align:center;}
.lbtn{
  width:100%;font-family:'Fredoka One',cursive;font-size:min(5vw,20px);
  padding:14px 20px;border:none;border-radius:20px;
  cursor:pointer;color:#fff;margin-bottom:10px;
  display:flex;align-items:center;gap:10px;text-align:left;
  transition:transform .15s;
}
.lbtn:active{transform:scale(.97);}
.lbtn .ld{font-family:'Nunito',sans-serif;font-size:min(3.2vw,13px);font-weight:700;opacity:.85;}
.l1{background:linear-gradient(135deg,#06D6A0,#059669);box-shadow:0 5px 18px rgba(6,214,160,.35);}
.l2{background:linear-gradient(135deg,#4ECDC4,#0891B2);box-shadow:0 5px 18px rgba(78,205,196,.35);}
.l3{background:linear-gradient(135deg,#A855F7,#7C3AED);box-shadow:0 5px 18px rgba(168,85,247,.35);}
.l4{background:linear-gradient(135deg,#FF6B35,#DC2626);box-shadow:0 5px 18px rgba(255,107,53,.35);}
.shop-row-btn{
  width:100%;font-family:'Fredoka One',cursive;font-size:min(4.5vw,18px);
  background:linear-gradient(135deg,var(--y),#FF9800);color:#0d0720;
  border:none;border-radius:20px;padding:12px;cursor:pointer;
  box-shadow:0 5px 18px rgba(255,215,0,.35);margin-top:4px;
  transition:transform .15s;
}
.shop-row-btn:active{transform:scale(.97);}

/* â•â• GAME SCREEN â•â• */
#s-game{padding-top:0;}
.hud{
  width:100%;max-width:500px;
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 0 8px;flex-shrink:0;gap:6px;
}
.lvl-pill{
  background:linear-gradient(135deg,var(--p),#4f46e5);
  border-radius:16px;padding:5px 12px;color:#fff;
  font-family:'Fredoka One',cursive;font-size:min(3.5vw,14px);
}
.streak-row{display:flex;gap:4px;align-items:center;}
.sd-dot{width:13px;height:13px;border-radius:50%;background:rgba(255,255,255,.12);border:2px solid rgba(255,255,255,.2);transition:all .3s cubic-bezier(.34,1.56,.64,1);}
.sd-dot.lit{background:var(--y);border-color:var(--o);box-shadow:0 0 8px var(--y);transform:scale(1.3);}

.score-row{
  width:100%;max-width:500px;
  display:grid;grid-template-columns:repeat(4,1fr);gap:6px;
  margin-bottom:8px;flex-shrink:0;
}
.sb{background:var(--card);border:2px solid var(--border);border-radius:12px;padding:5px 6px;text-align:center;}
.sl{color:rgba(255,255,255,.5);font-size:min(2.2vw,9px);text-transform:uppercase;letter-spacing:1px;line-height:1.2;}
.sv{font-family:'Fredoka One',cursive;font-size:min(5vw,20px);color:var(--y);line-height:1.2;}

.star-row-game{display:flex;justify-content:center;gap:3px;margin-bottom:6px;flex-shrink:0;}
.st{font-size:min(4vw,17px);opacity:.2;transition:all .4s cubic-bezier(.34,1.56,.64,1);}
.st.on{opacity:1;filter:drop-shadow(0 0 5px gold);transform:scale(1.2);}

.prog-wrap{width:100%;max-width:500px;background:rgba(255,255,255,.1);border-radius:20px;height:9px;overflow:hidden;margin-bottom:8px;flex-shrink:0;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--b),var(--p));border-radius:20px;transition:width .5s;box-shadow:0 0 7px var(--b);}

.pu-banner{
  width:100%;max-width:500px;
  background:linear-gradient(135deg,rgba(255,215,0,.22),rgba(255,107,53,.18));
  border:2px solid rgba(255,215,0,.38);border-radius:12px;
  padding:5px 12px;margin-bottom:6px;
  font-family:'Fredoka One',cursive;font-size:min(3.5vw,14px);color:var(--y);
  display:none;flex-shrink:0;
}
.pu-banner.show{display:block;}

.game-card{
  width:100%;max-width:500px;
  background:var(--card);border:3px solid var(--border);
  border-radius:26px;padding:14px 14px 10px;
  backdrop-filter:blur(20px);
  box-shadow:0 16px 50px rgba(0,0,0,.5);
  position:relative;overflow:hidden;flex-shrink:0;
}
.game-card::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(78,205,196,.07),transparent 55%);pointer-events:none;}
.ptag{font-size:min(2.8vw,11px);font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:3px 12px;border-radius:20px;display:inline-block;margin-bottom:6px;}
.ptag.easy{background:rgba(6,214,160,.2);color:var(--g);}
.ptag.med{background:rgba(78,205,196,.2);color:var(--b);}
.ptag.hard{background:rgba(168,85,247,.2);color:var(--p);}
.ptag.sup{background:rgba(255,107,53,.2);color:var(--o);}

.emoji-row{font-size:min(5.5vw,22px);margin-bottom:6px;min-height:34px;display:flex;flex-wrap:wrap;justify-content:center;gap:2px;align-items:center;}
.ei{animation:popIn .3s cubic-bezier(.34,1.56,.64,1) both;display:inline-block;}
@keyframes popIn{from{transform:scale(0) rotate(-20deg);opacity:0}to{transform:scale(1) rotate(0);opacity:1}}

.equation{
  font-family:'Fredoka One',cursive;
  font-size:min(14vw,56px);
  color:#fff;margin:2px 0 6px;letter-spacing:2px;
  text-shadow:0 0 20px rgba(255,255,255,.18);line-height:1.1;
}
.equation .n1{color:var(--pk);}
.equation .op{color:var(--g);}
.equation .n2{color:var(--b);}
.equation .eq{color:var(--y);}
.equation .qq{color:var(--o);display:inline-block;animation:qpls 1s infinite;}
@keyframes qpls{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}

.opts{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;}
.ob{
  font-family:'Fredoka One',cursive;
  font-size:min(8vw,32px);
  padding:12px 6px;border:none;border-radius:16px;
  cursor:pointer;color:#fff;
  transition:transform .12s;
}
.ob:active{transform:scale(.94);}
.ob:nth-child(1){background:linear-gradient(135deg,#FF6B9D,#e91e63);}
.ob:nth-child(2){background:linear-gradient(135deg,#4ECDC4,#0891B2);}
.ob:nth-child(3){background:linear-gradient(135deg,#A855F7,#7C3AED);}
.ob:nth-child(4){background:linear-gradient(135deg,#FFD93D,#FF9800);}
.ob.correct{animation:cAnim .55s ease;background:linear-gradient(135deg,#06D6A0,#059669)!important;}
.ob.wrong{animation:wAnim .45s ease;background:#ef4444!important;}
@keyframes cAnim{0%{transform:scale(1)}35%{transform:scale(1.3) rotate(5deg)}65%{transform:scale(1.08) rotate(-3deg)}100%{transform:scale(1)}}
@keyframes wAnim{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(10px)}60%{transform:translateX(-7px)}80%{transform:translateX(7px)}}

.feedback{font-family:'Fredoka One',cursive;font-size:min(5vw,20px);min-height:36px;display:flex;align-items:center;justify-content:center;margin-top:8px;}
.feedback.ok{color:var(--g);}
.feedback.err{color:#ff6b6b;}

.pet-corner{font-size:min(8vw,32px);position:absolute;bottom:10px;right:12px;animation:petBob 1.5s ease-in-out infinite alternate;pointer-events:none;}
@keyframes petBob{from{transform:translateY(0) rotate(-5deg)}to{transform:translateY(-6px) rotate(5deg)}}

.game-bottom{width:100%;max-width:500px;display:flex;justify-content:space-between;align-items:center;padding:8px 0 4px;flex-shrink:0;}
.ghost-btn{background:rgba(255,255,255,.09);border:2px solid var(--border);color:rgba(255,255,255,.75);font-family:'Fredoka One',cursive;font-size:min(3.8vw,15px);padding:8px 16px;border-radius:14px;cursor:pointer;transition:background .2s;}
.ghost-btn:active{background:rgba(255,255,255,.18);}
.shop-btn-sm{background:linear-gradient(135deg,var(--y),#FF9800);color:#0d0720;font-family:'Fredoka One',cursive;font-size:min(3.8vw,15px);padding:8px 16px;border-radius:14px;border:none;cursor:pointer;box-shadow:0 3px 12px rgba(255,215,0,.35);}

/* â•â• VICTORY â•â• */
#s-victory{justify-content:center;}
.v-emoji{font-size:min(20vw,80px);animation:float 2s ease-in-out infinite;margin-bottom:6px;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.v-title{font-family:'Fredoka One',cursive;font-size:min(12vw,52px);background:linear-gradient(135deg,var(--y),var(--o));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:vglow .8s ease infinite alternate;}
@keyframes vglow{from{filter:drop-shadow(0 0 8px rgba(255,215,0,.3))}to{filter:drop-shadow(0 0 28px rgba(255,215,0,.9))}}
.v-info{color:rgba(255,255,255,.85);font-size:min(4vw,16px);font-weight:700;margin:8px 0;text-align:center;line-height:1.6;}
.v-coins{font-family:'Fredoka One',cursive;font-size:min(5vw,20px);color:var(--y);margin:4px 0 10px;}
.v-stars{font-size:min(8vw,32px);margin:4px 0;}
.v-hint{color:rgba(255,255,255,.5);font-size:min(3.2vw,13px);font-weight:700;margin-bottom:10px;text-align:center;}
.vbtns{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:4px;}
.vbtn{font-family:'Fredoka One',cursive;font-size:min(4.5vw,18px);border:none;border-radius:24px;padding:12px 28px;cursor:pointer;transition:transform .15s;}
.vbtn:active{transform:scale(.95);}
.vbtn.green{background:linear-gradient(135deg,var(--g),#059669);color:#fff;box-shadow:0 5px 18px rgba(6,214,160,.35);}
.vbtn.gold{background:linear-gradient(135deg,var(--y),#FF9800);color:#0d0720;box-shadow:0 5px 18px rgba(255,215,0,.35);}
.vbtn.ghost{background:rgba(255,255,255,.1);color:#fff;border:2px solid rgba(255,255,255,.2);}

/* â•â• SHOP SCREEN â•â• */
#s-shop{z-index:20;}
.shop-hdr{font-family:'Fredoka One',cursive;font-size:min(7vw,28px);background:linear-gradient(135deg,var(--y),var(--o),var(--pk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:6px 0 4px;text-align:center;}
.shop-coins-bar{display:flex;align-items:center;gap:6px;background:rgba(255,215,0,.12);border:2px solid rgba(255,215,0,.3);border-radius:20px;padding:6px 16px;margin-bottom:12px;}
.sec-title{color:rgba(255,255,255,.4);font-size:min(2.8vw,11px);text-transform:uppercase;letter-spacing:3px;margin:10px 0 6px;text-align:left;width:100%;}
.items-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%;margin-bottom:4px;}
.ic{background:var(--card);border:2px solid var(--border);border-radius:16px;padding:10px 6px;cursor:pointer;transition:transform .15s;position:relative;text-align:center;}
.ic:active{transform:scale(.95);}
.ic.owned{border-color:var(--y);}
.ic.equipped{border-color:var(--b);box-shadow:0 0 12px rgba(78,205,196,.4);}
.ic.locked{opacity:.42;cursor:not-allowed;}
.ic-em{font-size:min(8vw,30px);display:block;margin-bottom:4px;}
.ic-name{color:#fff;font-size:min(2.8vw,11px);font-weight:700;margin-bottom:2px;line-height:1.2;}
.ic-price{color:var(--y);font-size:min(2.6vw,10px);font-weight:700;}
.ic-owned{color:var(--b);font-size:min(2.6vw,10px);font-weight:700;}
.eq-badge{position:absolute;top:4px;right:5px;background:var(--b);color:#0d0720;font-size:min(1.8vw,8px);font-weight:900;padding:1px 5px;border-radius:6px;text-transform:uppercase;}

.sticker-book{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;width:100%;}
.stk{background:rgba(255,255,255,.05);border:2px dashed rgba(255,255,255,.18);border-radius:10px;padding:6px 2px;text-align:center;font-size:min(5.5vw,20px);min-height:44px;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.stk.got{border:2px solid rgba(255,215,0,.35);background:rgba(255,215,0,.07);}
.stk-lbl{font-size:min(2vw,8px);color:rgba(255,255,255,.4);margin-top:2px;font-weight:700;}
.stk.got .stk-lbl{color:rgba(255,215,0,.6);}
.shop-close-btn{font-family:'Fredoka One',cursive;font-size:min(4.5vw,18px);background:linear-gradient(135deg,var(--pk),var(--p));color:#fff;border:none;border-radius:24px;padding:12px 36px;cursor:pointer;margin:14px 0 6px;box-shadow:0 5px 18px rgba(255,107,157,.35);}

/* â•â• OVERLAYS â•â• */
.overlay{position:fixed;inset:0;z-index:500;display:flex;align-items:center;justify-content:center;background:rgba(8,2,20,.88);backdrop-filter:blur(8px);opacity:0;pointer-events:none;transition:opacity .3s;}
.overlay.show{opacity:1;pointer-events:all;}
.pop{background:linear-gradient(135deg,#1e0a40,#0d0720);border-radius:30px;padding:26px 22px;text-align:center;box-shadow:0 0 50px rgba(255,215,0,.25),0 24px 60px rgba(0,0,0,.7);transform:scale(.4) rotate(-8deg);transition:transform .45s cubic-bezier(.34,1.56,.64,1);max-width:min(92vw,380px);width:92%;}
.overlay.show .pop{transform:scale(1) rotate(0);}
.pop-title{font-family:'Fredoka One',cursive;font-size:min(6.5vw,26px);background:linear-gradient(135deg,var(--y),var(--o),var(--pk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:8px 0 4px;}
.pop-sub{color:rgba(255,255,255,.75);font-size:min(3.8vw,15px);font-weight:700;margin-bottom:14px;}
.pop-btn{font-family:'Fredoka One',cursive;font-size:min(4.5vw,18px);background:linear-gradient(135deg,var(--y),#FF9800);color:#0d0720;border:none;border-radius:24px;padding:11px 32px;cursor:pointer;box-shadow:0 5px 18px rgba(255,215,0,.35);}

/* Monkey */
.mk-char{font-size:min(18vw,70px);display:block;animation:mkb .5s ease-in-out infinite alternate;filter:drop-shadow(0 6px 16px rgba(255,200,0,.4));}
@keyframes mkb{from{transform:translateY(0) rotate(-8deg) scaleX(1)}to{transform:translateY(-14px) rotate(8deg) scaleX(-1)}}
.chanclas{font-size:min(7vw,26px);display:flex;justify-content:center;gap:14px;margin:4px 0;}
.cl{animation:clL .6s ease-in-out infinite alternate;}
.cr{animation:clR .6s ease-in-out infinite alternate;}
@keyframes clL{from{transform:rotate(-20deg) translateY(0)}to{transform:rotate(10deg) translateY(-7px)}}
@keyframes clR{from{transform:rotate(20deg) translateY(-7px)}to{transform:rotate(-10deg) translateY(0)}}
.mk-stars-row{display:flex;justify-content:center;gap:5px;margin:8px 0;font-size:min(6vw,22px);}
.mk-stars-row span{animation:starPp .4s cubic-bezier(.34,1.56,.64,1) both;}
.mk-stars-row span:nth-child(1){animation-delay:.05s}.mk-stars-row span:nth-child(2){animation-delay:.15s}
.mk-stars-row span:nth-child(3){animation-delay:.25s}.mk-stars-row span:nth-child(4){animation-delay:.35s}
.mk-stars-row span:nth-child(5){animation-delay:.45s}
@keyframes starPp{from{transform:scale(0) rotate(-30deg);opacity:0}to{transform:scale(1);opacity:1}}
.mk-coins{font-family:'Fredoka One',cursive;font-size:min(4.5vw,18px);color:var(--y);margin-bottom:12px;}

/* Chest */
.chest-em-big{font-size:min(16vw,60px);display:block;margin:8px 0;}
.chest-reveal-em{font-size:min(14vw,52px);animation:revPop .5s cubic-bezier(.34,1.56,.64,1) both;}
@keyframes revPop{from{transform:scale(0) rotate(-20deg);opacity:0}to{transform:scale(1);opacity:1}}

/* â”€â”€ CONFETTI â”€â”€ */
.cf-wrap{position:fixed;inset:0;pointer-events:none;z-index:2000;overflow:hidden;}
.cp{position:absolute;top:-20px;border-radius:3px;animation:cfFall linear forwards;}
@keyframes cfFall{0%{transform:translateY(0) rotate(0) translateX(0);opacity:1}100%{transform:translateY(110vh) rotate(720deg) translateX(var(--drift));opacity:0}}

/* â”€â”€ FLOAT COIN â”€â”€ */
.float-coin{position:fixed;font-size:min(5vw,20px);pointer-events:none;z-index:1500;animation:fUp 1.1s ease-out forwards;}
@keyframes fUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-100px) scale(1.4)}}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:max(env(safe-area-inset-bottom,16px),16px);left:50%;transform:translateX(-50%) translateY(12px);background:linear-gradient(135deg,#1e0a40,#2d1060);border:2px solid rgba(255,215,0,.38);border-radius:18px;padding:10px 24px;color:#fff;font-family:'Fredoka One',cursive;font-size:min(4vw,16px);z-index:3000;opacity:0;transition:all .35s;pointer-events:none;white-space:nowrap;max-width:90vw;text-overflow:ellipsis;overflow:hidden;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* â”€â”€ SOUND BTN â”€â”€ */
.snd-btn{position:fixed;top:max(env(safe-area-inset-top,10px),10px);right:14px;z-index:400;background:rgba(255,255,255,.12);border:2px solid rgba(255,255,255,.2);border-radius:50%;width:38px;height:38px;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;}
</style>
</head>
<body>

<div class="orbs"><div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div></div>
<div class="star-bg" id="star-bg"></div>
<div class="cf-wrap" id="cf"></div>
<div class="toast" id="toast"></div>
<button class="snd-btn" id="snd-btn" onclick="toggleSound()">ğŸ”Š</button>

<!-- â•â• MONKEY OVERLAY â•â• -->
<div class="overlay" id="ov-monkey">
  <div class="pop">
    <span class="mk-char">ğŸ’</span>
    <div class="chanclas"><span class="cl">ğŸ©´</span><span class="cr">ğŸ©´</span></div>
    <div class="mk-stars-row"><span>â­</span><span>â­</span><span>â­</span><span>â­</span><span>â­</span></div>
    <div class="pop-title">Â¡MUY BIEN ANDRÃ‰S!</div>
    <div class="pop-sub">ğŸ‰ Â¡5 seguidas! ğŸ‰</div>
    <div class="mk-coins" id="mk-coins-txt">+5 ğŸª™ monedas</div>
    <button class="pop-btn" onclick="closeMonkey()">Â¡A seguir! ğŸš€</button>
  </div>
</div>

<!-- â•â• CHEST OVERLAY â•â• -->
<div class="overlay" id="ov-chest">
  <div class="pop">
    <div style="font-family:'Fredoka One',cursive;font-size:min(5vw,18px);color:var(--y);margin-bottom:8px;">ğŸ Â¡COFRE MISTERIOSO!</div>
    <span class="chest-em-big" id="chest-em">ğŸ“¦</span>
    <div id="chest-content"></div>
    <button class="pop-btn" id="chest-btn" onclick="openChest()">Â¡Abrir! âœ¨</button>
  </div>
</div>

<!-- â•â• COVER SCREEN â•â• -->
<div class="screen on" id="s-cover">
  <div class="cw" style="justify-content:center;flex:1;gap:4px;">
    <div class="cover-rocket">ğŸš€</div>
    <div class="cover-title">Â¡Mundo<br>MatemÃ¡tico!</div>
    <div class="cover-sub">âœ¨ La aventura de AndrÃ©s âœ¨</div>
    <button class="big-btn" onclick="showLevels()">Â¡Explorar! ğŸŒŸ</button>
  </div>
</div>

<!-- â•â• LEVEL SELECT â•â• -->
<div class="screen" id="s-levels">
  <div class="cw" style="padding-top:8px;">
    <div class="top-nav">
      <div style="width:60px"></div><!-- spacer -->
      <div class="ls-title">ğŸ® Elige nivel</div>
      <div class="coins-pill" onclick="openShop()">
        <span class="coin-spin">ğŸª™</span><span class="val" id="ls-coins">0</span>
      </div>
    </div>
    <div id="ls-pet" style="font-size:min(10vw,40px);margin-bottom:8px;animation:petBob 1.5s ease-in-out infinite alternate;"></div>
    <button class="lbtn l1" onclick="startGame(1)"><span style="font-size:min(7vw,26px)">ğŸ£</span><div><div>FÃ¡cil</div><div class="ld">Sumas hasta 10</div></div></button>
    <button class="lbtn l2" onclick="startGame(2)"><span style="font-size:min(7vw,26px)">ğŸ¬</span><div><div>Medio</div><div class="ld">Sumas hasta 20</div></div></button>
    <button class="lbtn l3" onclick="startGame(3)"><span style="font-size:min(7vw,26px)">ğŸ¦</span><div><div>DifÃ­cil</div><div class="ld">Â¡Dos dÃ­gitos! hasta 50</div></div></button>
    <button class="lbtn l4" onclick="startGame(4)"><span style="font-size:min(7vw,26px)">ğŸš€</span><div><div>Â¡SÃšPER!</div><div class="ld">Â¡Hasta 99! modo experto</div></div></button>
    <button class="shop-row-btn" onclick="openShop()">ğŸ›ï¸ Tienda de AndrÃ©s</button>
  </div>
</div>

<!-- â•â• GAME SCREEN â•â• -->
<div class="screen" id="s-game">
  <div class="cw">
    <!-- HUD -->
    <div class="hud">
      <button class="home-btn" onclick="goHome()">ğŸ  Inicio</button>
      <div class="streak-row" id="streak-row"></div>
      <div class="coins-pill" onclick="openShop()">
        <span class="coin-spin">ğŸª™</span><span class="val" id="hud-coins">0</span>
      </div>
    </div>
    <!-- Score -->
    <div class="score-row">
      <div class="sb"><div class="sl">âœ… Bien</div><div class="sv" id="sc-ok">0</div></div>
      <div class="sb"><div class="sl">ğŸ¯ Pregunta</div><div class="sv" id="sc-q">1/10</div></div>
      <div class="sb"><div class="sl">â­ Puntos</div><div class="sv" id="sc-pts">0</div></div>
      <div class="sb"><div class="sl">ğŸ”¥ Racha</div><div class="sv" id="sc-streak">0</div></div>
    </div>
    <!-- Stars -->
    <div class="star-row-game" id="star-row-game"></div>
    <!-- Progress -->
    <div class="prog-wrap"><div class="prog-fill" id="prog" style="width:10%"></div></div>
    <!-- Power-up banner -->
    <div class="pu-banner" id="pu-banner">âš¡ Â¡Modo BONUS activo! x2 monedas</div>
    <!-- Card -->
    <div class="game-card">
      <div class="ptag easy" id="ptag">FÃ¡cil ğŸ£</div>
      <div class="emoji-row" id="emoji-row"></div>
      <div class="equation">
        <span class="n1" id="n1">3</span>
        <span class="op"> + </span>
        <span class="n2" id="n2">2</span>
        <span class="eq"> = </span>
        <span class="qq">?</span>
      </div>
      <div class="opts" id="opts"></div>
      <div class="feedback" id="feedback"></div>
      <div class="pet-corner" id="pet-corner"></div>
    </div>
    <!-- Bottom row -->
    <div class="game-bottom">
      <button class="ghost-btn" onclick="goLevels()">â† Niveles</button>
      <div style="font-family:'Fredoka One',cursive;font-size:min(3.5vw,13px);color:rgba(255,255,255,.4);" id="lvl-pill-sm">Nivel 1 ğŸ£</div>
      <button class="shop-btn-sm" onclick="openShop()">ğŸ›ï¸ Tienda</button>
    </div>
  </div>
</div>

<!-- â•â• VICTORY SCREEN â•â• -->
<div class="screen" id="s-victory">
  <div class="cw" style="justify-content:center;flex:1;padding-top:10px;">
    <div class="top-nav">
      <button class="home-btn" onclick="goHome()">ğŸ  Inicio</button>
      <div style="width:60px"></div>
    </div>
    <div class="v-emoji" id="v-emoji">ğŸ†</div>
    <div class="v-title">Â¡CAMPEÃ“N!</div>
    <div class="v-info" id="v-info">Â¡AndrÃ©s eres increÃ­ble! ğŸŒŸ<br>9/10 correctas Â· 100 puntos</div>
    <div class="v-stars" id="v-stars">â­â­â­</div>
    <div class="v-coins" id="v-coins">ğŸª™ Ganaste 12 monedas</div>
    <div class="v-hint" id="v-hint"></div>
    <div class="vbtns">
      <button class="vbtn green" onclick="restartGame()">ğŸ”„ Â¡Otra vez!</button>
      <button class="vbtn gold" onclick="openShop()">ğŸ›ï¸ Tienda</button>
    </div>
    <button class="vbtn ghost" style="margin-top:8px" onclick="goLevels()">ğŸ® Cambiar nivel</button>
  </div>
</div>

<!-- â•â• SHOP SCREEN â•â• -->
<div class="screen" id="s-shop">
  <div class="cw">
    <div class="top-nav">
      <button class="home-btn" onclick="closeShop()">â† Volver</button>
      <div class="shop-hdr">ğŸ›ï¸ Tienda</div>
      <div class="shop-coins-bar" style="padding:5px 10px;">
        <span style="font-size:1rem">ğŸª™</span>
        <span style="font-family:'Fredoka One',cursive;color:var(--y);font-size:1rem" id="shop-coins">0</span>
      </div>
    </div>

    <div class="sec-title">ğŸ¾ Mascotas (te acompaÃ±an jugando)</div>
    <div class="items-grid" id="grid-pets"></div>

    <div class="sec-title">âš¡ Power-Ups (para la siguiente partida)</div>
    <div class="items-grid" id="grid-pups"></div>

    <div class="sec-title">ğŸ“¦ Cofres Misteriosos (Â¡sorpresa!)</div>
    <div class="items-grid" id="grid-chests"></div>

    <div class="sec-title">ğŸŒˆ Temas del juego</div>
    <div class="items-grid" id="grid-themes"></div>

    <div class="sec-title">â­ Mi colecciÃ³n de stickers</div>
    <div class="sticker-book" id="sticker-book"></div>
    <div style="color:rgba(255,215,0,.6);font-size:min(2.8vw,11px);font-weight:700;text-align:center;margin-top:6px;" id="stk-count">0/18 stickers</div>

    <button class="shop-close-btn" onclick="closeShop()">â† Volver a jugar</button>
  </div>
</div>

<script>
/* â”€â”€â”€ STARS â”€â”€â”€ */
const sbg=document.getElementById('star-bg');
for(let i=0;i<70;i++){const s=document.createElement('div');s.className='sd';const z=Math.random()*3.5+1;s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;width:${z}px;height:${z}px;animation-delay:${Math.random()*3}s;animation-duration:${1.5+Math.random()*2}s;`;sbg.appendChild(s);}

/* â”€â”€â”€ AUDIO â”€â”€â”€ */
let soundOn=true,actx=null;
function getCtx(){if(!actx)actx=new(window.AudioContext||window.webkitAudioContext)();return actx;}
function tone(f,t,d,v=0.26,dl=0){if(!soundOn)return;try{const c=getCtx();const o=c.createOscillator();const g=c.createGain();o.connect(g);g.connect(c.destination);o.type=t;o.frequency.setValueAtTime(f,c.currentTime+dl);g.gain.setValueAtTime(v,c.currentTime+dl);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+dl+d);o.start(c.currentTime+dl);o.stop(c.currentTime+dl+d);}catch(e){}}
function sfxOk(){[523,659,784,1047].forEach((f,i)=>tone(f,'sine',.18,.3,i*.1));setTimeout(()=>[784,1047,1319].forEach((f,i)=>tone(f,'triangle',.14,.2,i*.08)),480);}
function sfxWrong(){tone(250,'sawtooth',.14,.26);setTimeout(()=>tone(190,'sawtooth',.16,.2),170);}
function sfxClick(){tone(700,'sine',.06,.1);}
function sfxCoin(){[523,659,784,1047,1319].forEach((f,i)=>tone(f,'sine',.14,.3,i*.08));}
function sfxVictory(){[523,659,784,659,784,1047,1319].forEach((f,i)=>tone(f,'sine',.2,.34,i*.12));}
function sfxUnlock(){[392,523,659,784,1047,1319,1568].forEach((f,i)=>tone(f,'sine',.24,.36,i*.1));}
function sfxChest(){[262,330,392,523,659,784,1047,1319].forEach((f,i)=>tone(f,'sine',.22,.38,i*.09));}
function sfxMonkey(){const n=[523,784,659,1047,784,1319,1047,1568];n.forEach((f,i)=>tone(f,'sine',.2,.32,i*.1));setTimeout(()=>[784,1047,1319,1568].forEach((f,i)=>tone(f,'triangle',.16,.24,i*.09)),900);}
function toggleSound(){soundOn=!soundOn;document.getElementById('snd-btn').textContent=soundOn?'ğŸ”Š':'ğŸ”‡';}

/* â”€â”€â”€ STATE â”€â”€â”€ */
const ST={coins:0,streak:0,ownedPets:['pet0'],equippedPet:'pet0',ownedThemes:['th0'],equippedTheme:'th0',powerups:{x2:0,shield:0,skip:0},stickers:[],};

const PETS=[
  {id:'pet0',em:'ğŸ²',name:'DragÃ³n',free:true},
  {id:'pet1',em:'ğŸ¤–',name:'Robot',price:15},
  {id:'pet2',em:'ğŸ¦•',name:'Dino',price:20},
  {id:'pet3',em:'ğŸ‘¾',name:'Alien',price:25},
  {id:'pet4',em:'ğŸ¦',name:'LeÃ³n',price:30},
  {id:'pet5',em:'ğŸ§‘â€ğŸš€',name:'Astro',price:40},
];
const POWERUPS=[
  {id:'x2',em:'âš¡',name:'x2 Monedas',price:10,desc:'Doble 1 ronda'},
  {id:'shield',em:'ğŸ›¡ï¸',name:'Escudo',price:8,desc:'1 error gratis'},
  {id:'skip',em:'ğŸƒ',name:'ComodÃ­n',price:12,desc:'Salta pregunta'},
];
const CHESTS=[
  {em:'ğŸ“¦',name:'BÃ¡sico',price:10},{em:'ğŸ',name:'Dorado',price:20},{em:'ğŸ†',name:'Legendario',price:35}
];
const CHEST_PRIZES=[
  {em:'ğŸª™',name:'3 Monedas',coins:3},{em:'ğŸª™',name:'8 Monedas',coins:8},{em:'ğŸª™',name:'15 Monedas',coins:15},
  {em:'âš¡',name:'Power x2',pu:'x2'},{em:'ğŸ›¡ï¸',name:'Escudo',pu:'shield'},{em:'ğŸƒ',name:'ComodÃ­n',pu:'skip'},
  {em:'ğŸŒŸ',name:'Sticker',sticker:true},{em:'ğŸŠ',name:'20 Monedas',coins:20},
];
const THEMES=[
  {id:'th0',em:'ğŸŒŒ',name:'Espacio',free:true,bg:'#0d0720',c1:'#4ECDC4',c2:'#A855F7'},
  {id:'th1',em:'ğŸŒ¿',name:'Jungla',price:18,bg:'#051a0d',c1:'#06D6A0',c2:'#22c55e'},
  {id:'th2',em:'ğŸŒŠ',name:'OcÃ©ano',price:18,bg:'#040d1a',c1:'#38bdf8',c2:'#0ea5e9'},
  {id:'th3',em:'ğŸ”¥',name:'Fuego',price:22,bg:'#1a0600',c1:'#FF6B35',c2:'#ef4444'},
  {id:'th4',em:'âœ¨',name:'Galaxia',price:30,bg:'#080320',c1:'#c084fc',c2:'#e879f9'},
];
const ALL_STICKERS=['ğŸ†','ğŸŒŸ','ğŸš€','ğŸ¦','ğŸ²','ğŸ¤–','ğŸ’','ğŸ”¥','âš¡','ğŸ¯','ğŸ¥‡','ğŸ‘‘','ğŸŒˆ','ğŸŠ','ğŸ’ª','ğŸ§ ','ğŸ®','ğŸ›¸'];
const LEVEL_CONFIG={
  1:{icon:'ğŸ£',tc:'easy',tn:'FÃ¡cil ğŸ£',minA:1,maxA:6,minB:1,maxB:5,emoji:true},
  2:{icon:'ğŸ¬',tc:'med',tn:'Medio ğŸ¬',minA:5,maxA:12,minB:3,maxB:9,emoji:true},
  3:{icon:'ğŸ¦',tc:'hard',tn:'DifÃ­cil ğŸ¦',minA:10,maxA:35,minB:5,maxB:20,emoji:false},
  4:{icon:'ğŸš€',tc:'sup',tn:'Â¡SÃšPER! ğŸš€',minA:20,maxA:60,minB:10,maxB:39,emoji:false},
};
const EMOJIS={fr:['ğŸ','ğŸŠ','ğŸ‹','ğŸ‡','ğŸ“','ğŸ«','ğŸ’'],an:['ğŸ¶','ğŸ±','ğŸ°','ğŸ¸','ğŸ¦Š','ğŸ¼','ğŸ¦'],co:['â­','ğŸŒˆ','ğŸˆ','ğŸ€','ğŸ­','ğŸš€','ğŸŒ¸']};
const CEL=['ğŸ‰ Â¡GENIAL, ANDRÃ‰S!','ğŸŒŸ Â¡SÃšPER BIEN!','ğŸš€ Â¡ERES EL MEJOR!','â­ Â¡CORRECTO!','ğŸ† Â¡CAMPEÃ“N!','ğŸŠ Â¡PERFECTO!','ğŸ’ª Â¡QUÃ‰ CRACK!','ğŸ¥³ Â¡INCREÃBLE!'];
const ERR=['ğŸ˜… Â¡Casi! IntÃ©ntalo','ğŸ’™ Â¡No pasa nada!','ğŸŒˆ Â¡TÃº puedes!','ğŸ˜Š Â¡Sigue!'];

let currentLevel=1,currentQ=0,correctCount=0,gamePoints=0,answered=false;
let roundCoins=0,shieldActive=false,bonusActive=false;
const TOTAL=10;

/* â”€â”€â”€ SCREEN MANAGEMENT â”€â”€â”€ */
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('on'));
  document.getElementById(id).classList.add('on');
  window.scrollTo(0,0);
}
function goHome(){showScreen('s-cover');}
function goLevels(){showLevels();}
function showLevels(){
  showScreen('s-levels');
  document.getElementById('ls-coins').textContent=ST.coins;
  const pet=PETS.find(p=>p.id===ST.equippedPet);
  document.getElementById('ls-pet').textContent=pet?pet.em:'';
}

/* â”€â”€â”€ GAME â”€â”€â”€ */
function startGame(level){
  currentLevel=level;currentQ=0;correctCount=0;gamePoints=0;ST.streak=0;roundCoins=0;
  shieldActive=ST.powerups.shield>0;if(shieldActive){ST.powerups.shield--;showToast('ğŸ›¡ï¸ Escudo activado!');}
  bonusActive=ST.powerups.x2>0;if(bonusActive){ST.powerups.x2--;document.getElementById('pu-banner').classList.add('show');}
  else document.getElementById('pu-banner').classList.remove('show');

  showScreen('s-game');
  const cfg=LEVEL_CONFIG[level];
  document.getElementById('ptag').textContent=cfg.tn;
  document.getElementById('ptag').className='ptag '+cfg.tc;
  document.getElementById('lvl-pill-sm').textContent=`Nivel ${level} ${cfg.icon}`;

  // Star row
  const sr=document.getElementById('star-row-game');sr.innerHTML='';
  for(let i=0;i<TOTAL;i++){const s=document.createElement('span');s.className='st';s.id=`gst${i}`;s.textContent='â­';sr.appendChild(s);}
  // Streak dots
  const sd=document.getElementById('streak-row');sd.innerHTML='';
  for(let i=0;i<5;i++){const d=document.createElement('div');d.className='sd-dot';d.id=`dot${i}`;sd.appendChild(d);}
  // Pet
  const pet=PETS.find(p=>p.id===ST.equippedPet);
  document.getElementById('pet-corner').textContent=pet?pet.em:'';

  updateHUD();nextQuestion();
}
function restartGame(){startGame(currentLevel);}

function nextQuestion(){
  if(currentQ>=TOTAL){showVictory();return;}
  answered=false;
  const cfg=LEVEL_CONFIG[currentLevel];
  let mA=cfg.maxA,mB=cfg.maxB;
  if(currentQ>=7){mA=Math.min(cfg.maxA+10,99);mB=Math.min(cfg.maxB+5,45);}
  const n1=Math.floor(Math.random()*(mA-cfg.minA+1))+cfg.minA;
  const n2=Math.floor(Math.random()*(mB-cfg.minB+1))+cfg.minB;
  window._ans=n1+n2;
  document.getElementById('n1').textContent=n1;
  document.getElementById('n2').textContent=n2;
  document.getElementById('feedback').textContent='';
  document.getElementById('feedback').className='feedback';
  showEmojiRow(n1,n2);buildOpts(window._ans);
  updateHUD();
  document.getElementById('prog').style.width=`${((currentQ+1)/TOTAL)*100}%`;
}

function showEmojiRow(n1,n2){
  const el=document.getElementById('emoji-row');el.innerHTML='';
  const cfg=LEVEL_CONFIG[currentLevel];
  if(!cfg.emoji||(n1+n2)>14){el.style.minHeight='0';el.style.marginBottom='0';return;}
  el.style.minHeight='34px';el.style.marginBottom='6px';
  const sets=Object.values(EMOJIS);const set=sets[Math.floor(Math.random()*sets.length)];
  const arr=[];
  for(let i=0;i<n1;i++)arr.push(set[Math.floor(Math.random()*set.length)]);
  arr.push('â•');
  for(let i=0;i<n2;i++)arr.push(set[Math.floor(Math.random()*set.length)]);
  arr.forEach((e,i)=>{const sp=document.createElement('span');if(e==='â•'){sp.textContent=' â• ';sp.style.fontSize='1rem';}else{sp.className='ei';sp.textContent=e;sp.style.animationDelay=`${i*.05}s`;}el.appendChild(sp);});
}

function buildOpts(ans){
  const div=document.getElementById('opts');div.innerHTML='';
  const set=new Set([ans]);
  const sp=currentLevel<=2?3:currentLevel===3?7:12;let tries=0;
  while(set.size<4&&tries<200){tries++;const d=(Math.random()>.5?1:-1)*(Math.floor(Math.random()*sp)+1);const w=ans+d;if(w>=0&&w!==ans)set.add(w);}
  [...set].sort(()=>Math.random()-.5).forEach(v=>{
    const b=document.createElement('button');b.className='ob';b.textContent=v;
    b.onclick=()=>{sfxClick();checkAnswer(v,b);};
    div.appendChild(b);
  });
}

function checkAnswer(val,btn){
  if(answered)return;answered=true;
  const fb=document.getElementById('feedback');
  if(val===window._ans){
    btn.classList.add('correct');
    fb.textContent=CEL[Math.floor(Math.random()*CEL.length)];
    fb.className='feedback ok';
    correctCount++;gamePoints+=(currentLevel>=3?15:10)+(currentQ>=7?5:0);
    const cg=bonusActive?2:1;addCoins(cg);roundCoins+=cg;
    ST.streak++;
    document.getElementById(`gst${currentQ}`)?.classList.add('on');
    for(let i=0;i<5;i++)document.getElementById(`dot${i}`)?.classList.toggle('lit',i<ST.streak);
    updateHUD();sfxOk();confetti(30);
    if(ST.streak>=5){setTimeout(triggerMonkey,900);}
    else setTimeout(()=>{currentQ++;nextQuestion();},1800);
  } else {
    if(shieldActive){
      shieldActive=false;btn.classList.add('wrong');
      setTimeout(()=>{btn.classList.remove('wrong');answered=false;},600);
      showToast('ğŸ›¡ï¸ Â¡El escudo te salvÃ³!');return;
    }
    btn.classList.add('wrong');fb.textContent=ERR[Math.floor(Math.random()*ERR.length)];fb.className='feedback err';
    ST.streak=0;for(let i=0;i<5;i++)document.getElementById(`dot${i}`)?.classList.remove('lit');
    sfxWrong();
    setTimeout(()=>{btn.classList.remove('wrong');document.querySelectorAll('.ob').forEach(b=>{if(parseInt(b.textContent)===window._ans)b.classList.add('correct');});setTimeout(()=>{currentQ++;nextQuestion();},1100);},650);
  }
}

function addCoins(n){
  ST.coins+=n;
  document.getElementById('hud-coins').textContent=ST.coins;
  document.getElementById('ls-coins').textContent=ST.coins;
  const fc=document.createElement('div');fc.className='float-coin';fc.textContent=`+${n}ğŸª™`;
  fc.style.cssText=`left:${30+Math.random()*40}%;top:${25+Math.random()*25}%;`;
  document.body.appendChild(fc);setTimeout(()=>fc.remove(),1200);
  sfxCoin();
}

function updateHUD(){
  document.getElementById('hud-coins').textContent=ST.coins;
  document.getElementById('sc-ok').textContent=correctCount;
  document.getElementById('sc-q').textContent=`${currentQ+1}/${TOTAL}`;
  document.getElementById('sc-pts').textContent=gamePoints;
  document.getElementById('sc-streak').textContent=ST.streak;
}

/* â”€â”€â”€ MONKEY â”€â”€â”€ */
function triggerMonkey(){
  addCoins(5);roundCoins+=5;
  document.getElementById('mk-coins-txt').textContent=`+5 ğŸª™ â€¢ Total: ${ST.coins} ğŸª™`;
  document.getElementById('ov-monkey').classList.add('show');
  sfxMonkey();confetti(70);setTimeout(()=>confetti(50),500);
}
function closeMonkey(){
  document.getElementById('ov-monkey').classList.remove('show');
  ST.streak=0;for(let i=0;i<5;i++)document.getElementById(`dot${i}`)?.classList.remove('lit');
  currentQ++;nextQuestion();
}

/* â”€â”€â”€ CHEST â”€â”€â”€ */
let chestPrize=null;
function triggerChest(){
  chestPrize=null;
  document.getElementById('chest-em').textContent='ğŸ“¦';
  document.getElementById('chest-content').innerHTML='';
  document.getElementById('chest-btn').textContent='Â¡Abrir! âœ¨';
  document.getElementById('ov-chest').classList.add('show');
  sfxCoin();confetti(40);
}
function openChest(){
  if(!chestPrize){
    chestPrize=CHEST_PRIZES[Math.floor(Math.random()*CHEST_PRIZES.length)];
    document.getElementById('chest-em').textContent='ğŸ';
    sfxChest();confetti(60);
    setTimeout(()=>{
      document.getElementById('chest-em').textContent=chestPrize.em;
      document.getElementById('chest-content').innerHTML=`<div class="chest-reveal-em">${chestPrize.em}</div><div style="font-family:'Fredoka One',cursive;font-size:min(5vw,18px);color:#fff;margin:6px 0 2px">${chestPrize.name}</div>`;
      if(chestPrize.coins){addCoins(chestPrize.coins);showToast(`ğŸª™ +${chestPrize.coins} monedas`);}
      if(chestPrize.pu){ST.powerups[chestPrize.pu]=(ST.powerups[chestPrize.pu]||0)+1;sfxUnlock();showToast(`${chestPrize.em} Â¡Power-up aÃ±adido!`);}
      if(chestPrize.sticker){const a=ALL_STICKERS.filter(s=>!ST.stickers.includes(s));if(a.length){const s=a[Math.floor(Math.random()*a.length)];ST.stickers.push(s);sfxUnlock();showToast(`${s} Â¡Nuevo sticker!`);}else{addCoins(5);}}
      document.getElementById('chest-btn').textContent='Â¡Cerrar!';
    },500);
  } else {
    document.getElementById('ov-chest').classList.remove('show');
  }
}

/* â”€â”€â”€ VICTORY â”€â”€â”€ */
function showVictory(){
  showScreen('s-victory');
  const pct=correctCount/TOTAL;
  document.getElementById('v-emoji').textContent=pct>=.9?'ğŸ†ğŸŒŸğŸŠ':pct>=.7?'â­ğŸ‰ğŸ˜Š':'ğŸ’™ğŸŒˆâœ¨';
  document.getElementById('v-info').innerHTML=`Â¡AndrÃ©s eres increÃ­ble! ğŸŒŸ<br>${correctCount}/${TOTAL} correctas Â· ${gamePoints} puntos`;
  document.getElementById('v-stars').textContent=pct>=.9?'â­â­â­':pct>=.7?'â­â­':'â­';
  document.getElementById('v-coins').textContent=`ğŸª™ Ganaste ${roundCoins} monedas (total: ${ST.coins})`;
  if(pct>=.9){document.getElementById('v-hint').textContent='ğŸ Â¡Perfecto! Â¡Ganaste un cofre!';setTimeout(triggerChest,1500);}
  else document.getElementById('v-hint').textContent='';
  sfxVictory();
  for(let i=0;i<5;i++)setTimeout(()=>confetti(45),i*320);
}

/* â”€â”€â”€ SHOP â”€â”€â”€ */
let shopFrom='';
function openShop(){
  // Remember which screen we came from
  const screens=['s-game','s-victory','s-levels','s-cover'];
  shopFrom=screens.find(id=>document.getElementById(id).classList.contains('on'))||'s-levels';
  showScreen('s-shop');
  document.getElementById('shop-coins').textContent=ST.coins;
  renderPets();renderPowerupShop();renderChestShop();renderThemes();renderStickers();
}
function closeShop(){
  showScreen(shopFrom||'s-levels');
  document.getElementById('ls-coins').textContent=ST.coins;
  document.getElementById('hud-coins').textContent=ST.coins;
}

function renderPets(){
  const g=document.getElementById('grid-pets');g.innerHTML='';
  PETS.forEach(p=>{
    const owned=ST.ownedPets.includes(p.id);const equipped=ST.equippedPet===p.id;
    const canBuy=!owned&&ST.coins>=(p.price||0);
    const d=document.createElement('div');d.className='ic'+(owned?' owned':'')+(equipped?' equipped':'')+((!owned&&!canBuy)?' locked':'');
    d.innerHTML=`${equipped?'<div class="eq-badge">âœ“</div>':''}<span class="ic-em">${p.em}</span><div class="ic-name">${p.name}</div>${owned?`<div class="ic-owned">${equipped?'Activa':'Tocar'}</div>`:`<div class="ic-price">ğŸª™${p.price}</div>`}`;
    if(owned&&!equipped)d.onclick=()=>{sfxClick();ST.equippedPet=p.id;document.getElementById('pet-corner').textContent=p.em;renderPets();showToast(`${p.em} Â¡${p.name} equipada!`);};
    else if(!owned&&canBuy)d.onclick=()=>{ST.coins-=p.price;ST.ownedPets.push(p.id);ST.equippedPet=p.id;sfxUnlock();confetti(40);document.getElementById('pet-corner').textContent=p.em;document.getElementById('shop-coins').textContent=ST.coins;showToast(`${p.em} Â¡${p.name} desbloqueada!`);renderPets();};
    else if(!owned&&!canBuy)d.onclick=()=>showToast('Â¡Necesitas mÃ¡s monedas!');
    g.appendChild(d);
  });
}

function renderPowerupShop(){
  const g=document.getElementById('grid-pups');g.innerHTML='';
  POWERUPS.forEach(p=>{
    const qty=ST.powerups[p.id]||0;
    const d=document.createElement('div');d.className='ic';
    d.innerHTML=`<span class="ic-em">${p.em}</span><div class="ic-name">${p.name}</div><div class="ic-owned">Tienes:${qty}</div><div class="ic-price">ğŸª™${p.price}</div>`;
    d.onclick=()=>{if(ST.coins>=p.price){ST.coins-=p.price;ST.powerups[p.id]=(ST.powerups[p.id]||0)+1;sfxCoin();document.getElementById('shop-coins').textContent=ST.coins;showToast(`${p.em} Â¡${p.name}!`);renderPowerupShop();}else showToast('Â¡Necesitas mÃ¡s monedas!');};
    g.appendChild(d);
  });
}

function renderChestShop(){
  const g=document.getElementById('grid-chests');g.innerHTML='';
  CHESTS.forEach(c=>{
    const d=document.createElement('div');d.className='ic';
    d.innerHTML=`<span class="ic-em">${c.em}</span><div class="ic-name">${c.name}</div><div class="ic-price">ğŸª™${c.price}</div>`;
    d.onclick=()=>{if(ST.coins>=c.price){ST.coins-=c.price;document.getElementById('shop-coins').textContent=ST.coins;closeShop();triggerChest();}else showToast('Â¡Necesitas mÃ¡s monedas!');};
    g.appendChild(d);
  });
}

function renderThemes(){
  const g=document.getElementById('grid-themes');g.innerHTML='';
  THEMES.forEach(th=>{
    const owned=ST.ownedThemes.includes(th.id);const equipped=ST.equippedTheme===th.id;
    const canBuy=!owned&&ST.coins>=(th.price||0);
    const d=document.createElement('div');d.className='ic'+(owned?' owned':'')+(equipped?' equipped':'')+((!owned&&!canBuy&&!th.free)?' locked':'');
    d.innerHTML=`${equipped?'<div class="eq-badge">âœ“</div>':''}<span class="ic-em">${th.em}</span><div class="ic-name">${th.name}</div>${owned?`<div class="ic-owned">${equipped?'Activo':'Tocar'}</div>`:`<div class="ic-price">ğŸª™${th.price}</div>`}`;
    if(owned&&!equipped)d.onclick=()=>equipTheme(th);
    else if(!owned&&canBuy)d.onclick=()=>{ST.coins-=th.price;ST.ownedThemes.push(th.id);document.getElementById('shop-coins').textContent=ST.coins;sfxUnlock();equipTheme(th);};
    else if(!owned&&!canBuy)d.onclick=()=>showToast('Â¡Necesitas mÃ¡s monedas!');
    g.appendChild(d);
  });
}

function equipTheme(th){
  ST.equippedTheme=th.id;
  document.documentElement.style.setProperty('--bg',th.bg);
  document.documentElement.style.setProperty('--b',th.c1);
  document.documentElement.style.setProperty('--p',th.c2);
  document.body.style.background=th.bg;
  showToast(`${th.em} Â¡Tema ${th.name}!`);confetti(28);renderThemes();
}

function renderStickers(){
  const g=document.getElementById('sticker-book');g.innerHTML='';
  ALL_STICKERS.forEach(s=>{
    const got=ST.stickers.includes(s);
    const d=document.createElement('div');d.className='stk'+(got?' got':'');
    d.innerHTML=got?`<span>${s}</span><div class="stk-lbl">Â¡Tengo!</div>`:`<span style="opacity:.2">â“</span><div class="stk-lbl">???</div>`;
    g.appendChild(d);
  });
  document.getElementById('stk-count').textContent=`${ST.stickers.length}/${ALL_STICKERS.length} stickers`;
}

/* â”€â”€â”€ CONFETTI â”€â”€â”€ */
function confetti(n=45){
  const w=document.getElementById('cf');
  const cols=['#FFD93D','#FF6B35','#4ECDC4','#A855F7','#FF6B9D','#06D6A0','#fff'];
  for(let i=0;i<n;i++){const p=document.createElement('div');p.className='cp';p.style.cssText=`left:${Math.random()*100}vw;background:${cols[~~(Math.random()*cols.length)]};width:${5+Math.random()*9}px;height:${5+Math.random()*9}px;border-radius:${Math.random()>.5?'50%':'3px'};--drift:${(Math.random()-.5)*200}px;animation-duration:${1.3+Math.random()*1.4}s;animation-delay:${Math.random()*.35}s;`;w.appendChild(p);setTimeout(()=>p.remove(),3000);}
}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
let toastT=null;
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');if(toastT)clearTimeout(toastT);toastT=setTimeout(()=>t.classList.remove('show'),2000);}
</script>
</body>
</html>
